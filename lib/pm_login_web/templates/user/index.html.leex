<div role="main" class="container">
  <p class="alert alert-info" role="alert"
    phx-click="lv:clear-flash"
    phx-value-key="info"><%= live_flash(@flash, :info) %></p>

  <p class="alert alert-danger" role="alert"
    phx-click="lv:clear-flash"
    phx-value-key="error"><%= live_flash(@flash, :error) %></p>
</div>

<% alias PmLoginWeb.LiveComponent.ModalLive %>
  <h1><i class="bi bi-card-list"></i> Liste des utilisateurs</h1>

  <div class="row">
    <div class="column column-10">
      <!-- <b style="position: relative; top: 8px;">Filtre :</b> -->
      <i class="bi bi-filter filter__icon"></i>
    </div>

    <div class="column column-20">
      <form phx-change="right_selected">

        <select id="right_filter" name="right_select">
        <option value="" selected disabled hidden>par statut</option>
        <option value="9000">Tout</option>
          <%= for right <- @rights do %>
        <option value="<%= right.id %>"><%= right.title %></option>
          <% end %>
        </select>

      </form>
    </div>

    <div class="column column-10">
      <!-- <b style="position: relative; top: 8px;"></b> -->
      <i class="bi bi-sort-alpha-down sort__icon"></i>
    </div>

    <div class="column column-20">
      <form phx-change="sort_users">

        <select id="sort_auth" name="sort_select">
        <option value="" selected disabled hidden>alphabÃ©tique</option>
        <option value="asc">A - Z</option>
        <option value="desc">Z - A</option>
        </select>

      </form>
    </div>

    <div class="column column-10">
      <i class="bi bi-search srch__icon"></i>
    </div>

    <div class="column column-20">
      <form phx-change="search-user">
          <input type="text" name="search-a" style="width: 150px;">
      </form>
    </div>



  </div>



  <table id="tb-auth">
    <thead>
      <tr>
        <th></th>
        <th><span><i class="bi bi-caret-down-fill arr__sorted" phx-click="sorted_by_username"></i></span> Nom d'utilisateur</th>
        <th><span><i class="bi bi-caret-down-fill arr__sorted" phx-click="sorted_by_email"></i></span> Email</th>
        <th><span><i class="bi bi-caret-down-fill arr__sorted" phx-click="sorted_by_status"></i></span> Statut</th>

        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <%= for user <- @users do %>
      <tr>

        <td style="width: 50px;">
            <img class="profile-pic-mini" src="<%= Routes.static_path(@socket, "/#{user.profile_picture}") %>" width="50"/>
        </td>

        <td><%= user.username %></td>
        <td><%= user.email %></td>
        <td><%= user.title %></td>

        <td>
          <%= if user.id != @curr_user_id do %>
              <a href="<%= Routes.user_path(@socket, :edit, user) %>" class=""><i class="bi bi-info-circle info__user btn btn-info btn-lg"></i></a>
              <%= if user.right_id != 100 do %>
              <i class="bi bi-archive btn btn-danger btn-lg archive__user" phx-click="go-arch" phx-value-id="<%= user.id %>"></i>
              <% else %>
              <i class="bi bi-archive btn btn-dark btn-lg"></i>
            <% end %>

          <% end %>
        </td>
      </tr>
      <% end %>
    </tbody>
  </table>

  <%= if @show_modal do %>
<%= live_component(@socket,
                     ModalLive,
                     id: "confirm-arch",
                     title: "Archiver?",
                     body: "Etes-vous sÃ»r d'archiver l'utilisateur #{PmLogin.Login.get_username(@arch_id)}?",
                     right_button: "OUI",
                     right_button_action: "arch",
                     right_button_param: @arch_id,
                     left_button: "ANNULER",
                     left_button_action: "cancel-arch")
  %>
<% end %>
